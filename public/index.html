<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Tesseract Test</title>
        <link href="styles/style.css" rel="stylesheet" type="text/css">
        <script src="https://cdn.rawgit.com/naptha/tesseract.js/1.0.10/dist/tesseract.js"></script>
    </head>
    <body onload="">
        <input type="text" id="url" placeholder="Image URL" />
        <input type="button" id="go_button" value="Run" />
        <div id="create_playlist">
            <a href="/create_playlist">Create Festival Playlist on Spotify</a>
        </div>    
        <div id="ocr_image"> </div>
        <div id="ocr_results"> </div>
        <div id="ocr_status"> </div>  
        <div id="nice_results"> </div>  
    </body>
</html>

<script>

document.getElementById("go_button")
.addEventListener("click", function(e) {
    clearResults();
    var url = document.getElementById("url").value;
    dispImage(url);
    var textOCR = runOCR(url);
});

document.getElementById("create_playlist")
.addEventListener("click", function(e) {
    doLogin();
});

function dispImage(url) {
    document.getElementById("ocr_image")
    .innerHTML = "Parsing text from the following image:<br><img src='" + url + "' class='responsive-image'>";
}

function runOCR(url) {
    Tesseract.recognize(url)
        .then(function(result) {
            document.getElementById("ocr_results")
            .innerText = result.text;
            createArtistList(result.text);
        }).progress(function(result) {
            document.getElementById("ocr_status")
            .innerText = result["status"] + " (" +
            (result["progress"] * 100) + "%)";
        });
    
    }

// Convert gross OCR results into a list
function createArtistList(rawText) {
    var separators = /\s\W\s/;
    var list = rawText.split(separators);
    /*
    var listString = "";
    var i;
    for (i = 0; i < list.length; i++) {
        listString += "\n" + list[i]; 
    }
    document.getElementById("nice_results")
    .innerText = listString;
    */
}

// Clear current image and details
function clearResults() {
    document.getElementById("ocr_image")
    .innerHTML = " ";
    document.getElementById("ocr_results")
    .innerHTML = " ";
    document.getElementById("ocr_status")
    .innerHTML = " ";
    document.getElementById("nice_results")
    .innerHTML = " ";
}
/*
// Authorize Spotify user
function doLogin() {

}
*/
// Generate Spotify playlist

</script>
        
